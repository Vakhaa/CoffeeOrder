(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{15:function(e,r,t){},42:function(e,r,t){"use strict";t.r(r);var n=t(16),c=t(10),o=t(9),u=(t(15),t(4)),i=function(e){var r=e.name,t=e.onClick;return Object(u.jsxs)("div",{className:"Header container ",children:[Object(u.jsx)("div",{children:r||"You are guest. Please, log in."}),Object(u.jsx)("button",{onClick:function(){return t()},children:r?"Log out":"Log in"})]})},a=t(6),d=t.n(a),s=t(7),l="LOGIN_REQUEST",f="LOGIN_SUCCESS",O="LOGIN_ERROR",p="LOGOUT_REQUEST",b="LOGOUT_RECEIVE",j="LOGOUT_ERROR",v="GET_PRODUCTS_REQUEST",E="GET_PRODUCTS_RECEIVE",R="GET_PRODUCTS_ERROR",h="ADD_PRODUCT_TO_ORDER_REQUEST",_="ADD_PRODUCT_TO_ORDER_RECEIVE",y="ADD_PRODUCT_TO_ORDER_ERROR",m="DELETE_PRODUCT_FROM_ORDER_REQUEST",C="DELETE_PRODUCT_FROM_ORDER_RECEIVE",T="DELETE_PRODUCT_FROM_ORDER_ERROR",P="CHANGE_COUNT_PRODUCT_INTO_ORDER_REQUEST",g="CHANGE_COUNT_PRODUCT_INTO_ORDER_RECEIVE",x="CHANGE_COUNT_PRODUCT_INTO_ORDER_ERROR",I="GET_ORDER_REQUEST",D="GET_ORDER_RECEIVE",k="GET_ORDER_ERROR",S="CREATE_ORDER",U="ORDER_EXISTS",N="CLEAN_ORDER",w="CANCEL_ORDER_REQUEST",L="CANCEL_ORDER_RECEIVE",G="CANCEL_ORDER_ERROR",M="SUBMIT_ORDER_REQUEST",A="SUBMIT_ORDER_RECEIVE",B="SUBMIT_ORDER_ERROR",Q=t(11),q=(t(36),t(2)),V=t(18);t(38),t(43);Q.a.initializeApp({apiKey:"AIzaSyCrrzay9q_ebYMNUv3PvZFkbH0QjJNuGcM",authDomain:"coffeeorder-4f01e.firebaseapp.com",databaseURL:"https://coffeeorder-4f01e-default-rtdb.europe-west1.firebasedatabase.app",projectId:"coffeeorder-4f01e",storageBucket:"coffeeorder-4f01e.appspot.com",messagingSenderId:"147709475008",appId:"1:147709475008:web:6931eaacdab46d56c51525"});var F=Q.a.database(),H=Q.a.storage();function J(e){return{type:k,error:e}}function z(e){return{type:G,error:e}}function Y(e){return{type:B,error:e}}function K(e){return function(r){var t=F.ref("Order");t.on("value",(function(n){t.orderByChild("userId").equalTo(e).once("value",(function(c){if(c.val())r({type:U});else{var o=[].concat(Object(V.a)(n.val()),[{isSubmit:!1,userId:e}]);t.set(o)}}))})),r({type:S})}}function W(e){return function(){var r=Object(s.a)(d.a.mark((function r(t){return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t({type:I});try{F.ref("Order").orderByChild("userId").equalTo(e).on("child_added",(function(e){F.ref("Products").on("value",(function(r){var n,c,o=Object(q.a)(Object(q.a)({},e.val()),{},{Products:null===(n=e.val())||void 0===n||null===(c=n.Products)||void 0===c?void 0:c.map((function(e){return e=Object(q.a)(Object(q.a)({},r.val().find((function(r){var t;return(null===(t=e)||void 0===t?void 0:t.productId)===(null===r||void 0===r?void 0:r.id)}))),{},{count:e.count})}))});t({type:D,order:o})}))}))}catch(n){t(J(n))}case 2:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}var X=new Q.a.auth.GoogleAuthProvider;var Z=Object(o.c)(Object(c.b)((function(e){return{profile:e.login.profile}}),(function(e){return{login:function(){return e(function(){var e=Object(s.a)(d.a.mark((function e(r){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r({type:l}),e.prev=1,e.next=4,Q.a.auth().signInWithPopup(X);case 4:t=e.sent,r(K(t.additionalUserInfo.profile.id)),r((c=t.additionalUserInfo.profile,{type:f,profile:c})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),r((n=e.t0,{type:O,error:n}));case 12:case"end":return e.stop()}var n,c}),e,null,[[1,9]])})));return function(r){return e.apply(this,arguments)}}())},logout:function(){return e(function(){var e=Object(s.a)(d.a.mark((function e(r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r({type:p});try{Q.a.auth().signOut(),r({type:N}),r({type:b})}catch(t){r({type:j})}case 2:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}())}}})))((function(e){return e.profile?Object(u.jsx)(i,{name:e.profile.name,onClick:e.logout}):Object(u.jsx)(i,{onClick:e.login})})),$=t(13),ee=t(1),re=function(e){var r=e.products,t=e.addProduct,n=e.userId,c=e.isEditMode;return Object(u.jsxs)("div",{className:"Menu  container",children:[Object(u.jsx)("h3",{children:"Menu"}),Object(u.jsx)("div",{className:"Products",children:r.map((function(e){return Object(u.jsxs)("div",{className:"item Product",children:[e.title,"  ",e.price,Object(u.jsx)("button",{onClick:function(){return t(n,e.id)},disabled:!c||e.isInOrder,children:"+"})]},e.id)}))})]})};function te(e){return{type:y,error:e}}function ne(e){return{type:T,error:e}}function ce(e){return{type:x,error:e}}function oe(e,r){return function(){var t=Object(s.a)(d.a.mark((function t(n){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n({type:m});try{F.ref("Order").orderByChild("userId").equalTo(e).once("child_added",(function(e){F.ref("Order/"+e.key+"/Products").once("value",(function(t){var n,c=null===(n=t.val())||void 0===n?void 0:n.filter((function(e){return e.productId!==r}));F.ref("Order/"+e.key+"/Products").set(c)}))})),n(oe()),n(W(e))}catch(c){n(ne(c))}case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}function ue(e){return{type:R,error:e}}var ie=Object(o.c)(Object(c.b)((function(e){return{products:e.products.products,order:e.order.order,profile:e.login.profile}}),(function(e){return{addProduct:function(r,t){return e(function(e,r){return function(){var t=Object(s.a)(d.a.mark((function t(n){var c,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n({type:h});try{c=F.ref("Order"),o={productId:r,count:1},c.orderByChild("userId").equalTo(e).once("child_added",(function(e){F.ref("Order/"+e.key+"/Products").once("value",(function(r){var t=r.val()?[].concat(Object(V.a)(r.val()),[o]):[o];F.ref("Order/"+e.key).child("Products").set(t)}))})),n({type:_}),n(W(e))}catch(u){n(te(u))}case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(r,t))},getProducts:function(){return e(function(){var e=Object(s.a)(d.a.mark((function e(r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r({type:v});try{F.ref("Products").on("value",(function(e){return r((t=e.val(),{type:E,products:t}));var t}))}catch(t){r(ue(t))}case 2:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}())}}})))((function(e){var r=Object(ee.useState)(!1),t=Object($.a)(r,2),n=t[0],c=t[1],o=Object(ee.useState)(e.products),i=Object($.a)(o,2),a=i[0],d=i[1];Object(ee.useEffect)((function(){d(e.products)}),[e.products]),Object(ee.useEffect)((function(){var r=null===a||void 0===a?void 0:a.map((function(r){var t,n;return r=Object(q.a)(Object(q.a)({},r),{},{isInOrder:!!(null===(t=e.order)||void 0===t||null===(n=t.Products)||void 0===n?void 0:n.find((function(e){return e.id===r.id})))})}));d(r)}),[e.order]),Object(ee.useEffect)((function(){e.getProducts(),c(!!e.profile)}),[e.profile]);return a?Object(u.jsx)(re,{products:a,addProduct:e.addProduct,userId:e.profile?e.profile.id:0,isEditMode:n}):Object(u.jsx)(u.Fragment,{children:"Loading"})})),ae=function(e){var r,t,n;return Object(u.jsxs)("div",{className:"Order container",children:[Object(u.jsx)("h3",{children:"Order"}),Object(u.jsxs)("div",{children:[(null===(r=e.order)||void 0===r?void 0:r.Products)?e.order.Products.map((function(r){var t,n,c;return Object(u.jsxs)("div",{className:"item Product",children:[Object(u.jsx)("button",{onClick:function(){return e.deleteProduct(e.profile.id,r.id)},disabled:null===(t=e.order)||void 0===t?void 0:t.isSubmit,children:"x"}),r.title,Object(u.jsx)("button",{onClick:function(){return e.changeCount(e.profile.id,r.id,!1)},disabled:null===(n=e.order)||void 0===n?void 0:n.isSubmit,children:"-"}),r.count,Object(u.jsx)("button",{onClick:function(){return e.changeCount(e.profile.id,r.id,!0)},disabled:null===(c=e.order)||void 0===c?void 0:c.isSubmit,children:"+"}),r.price]},r.id)})):Object(u.jsx)("div",{className:"item Product",children:"Empty"}),Object(u.jsxs)("div",{className:"item Product",children:["Total : ",e.totalPrice]}),Object(u.jsxs)("div",{className:"item",children:[Object(u.jsx)("button",{onClick:function(){return e.cancelOrder(e.profile.id)},disabled:!e.isEditMode||(null===(t=e.order)||void 0===t?void 0:t.isSubmit),children:"Cancel "}),Object(u.jsx)("button",{onClick:function(){return e.submitOrder(e.profile.id,e.order)},disabled:!e.isEditMode||(null===(n=e.order)||void 0===n?void 0:n.isSubmit),children:"Submit "})]})]})]})},de=Object(o.c)(Object(c.b)((function(e){return{order:e.order.order,profile:e.login.profile}}),(function(e){return{submitOrder:function(r,t){return e(function(e,r){return function(){var t=Object(s.a)(d.a.mark((function t(n){var c,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n({type:M});try{c=JSON.stringify(r),console.log(c),o=new Blob([c],{type:"application/json"}),H.ref("orders/order "+e+".json").put(o).on("state_changed",(function(e){console.log(e.state)})),F.ref("Order").orderByChild("userId").equalTo(e).once("child_added",(function(e){var t=Object(q.a)(Object(q.a)({},r),{},{Products:null===r||void 0===r?void 0:r.Products.map((function(e){return{productId:e.id,count:e.count}})),isSubmit:!0});F.ref("Order/"+e.key).set(t)})),n({type:A}),n(W(e))}catch(u){n(Y(u))}case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(r,t))},cancelOrder:function(r){return e(function(e){return function(){var r=Object(s.a)(d.a.mark((function r(t){return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t({type:w});try{F.ref("Order").orderByChild("userId").equalTo(e).once("child_added",(function(e){e.val()&&F.ref("Order/"+e.key).remove()})),t(W(e)),t({type:L})}catch(n){t(z(n))}case 2:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}(r))},getOrder:function(r){return e(W(r))},changeCount:function(r,t,n){return e(function(e,r,t){return function(){var n=Object(s.a)(d.a.mark((function n(c){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:c({type:P});try{F.ref("Order").orderByChild("userId").equalTo(e).on("child_added",(function(e){F.ref("Order/"+e.key+"/Products").once("value",(function(n){var o=n.val();if(o){var u=null===o||void 0===o?void 0:o.filter((function(e){return e.productId===r}));if(u&&1===u[0].count&&!t){var i,a=null===(i=n.val())||void 0===i?void 0:i.filter((function(e){return e.productId!==r}));F.ref("Order/"+e.key).child("Products").set(a)}else{var d=o.map((function(e){return e.productId===r?e=Object(q.a)(Object(q.a)({},e),{},{count:t?++e.count:--e.count}):e}));F.ref("Order/"+e.key+"/Products").set(d)}c({type:g})}else c(ce())}))})),c(W(e))}catch(o){c(ce(o))}case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}(r,t,n))},deleteProduct:function(r,t){return e(oe(r,t))}}})))((function(e){var r=Object(ee.useState)(e.order),t=Object($.a)(r,2),n=t[0],c=t[1];Object(ee.useEffect)((function(){c(e.order)}),[e.order]);var o=Object(ee.useState)(0),i=Object($.a)(o,2),a=i[0],d=i[1];Object(ee.useEffect)((function(){var e,r=0;null===n||void 0===n||null===(e=n.Products)||void 0===e||e.map((function(e){return r+=e.count*e.price})),d(r)}),[null===n||void 0===n?void 0:n.Products]),Object(ee.useEffect)((function(){!e.profile||e.getOrder(e.profile.id)}),[e.profile]);return(null===n||void 0===n?void 0:n.isSubmit)?Object(u.jsxs)("div",{className:"congratulation",children:[Object(u.jsxs)("div",{className:"item Product",children:["Thank you for complete order. The total cost is ",a," tugrikow."]}),Object(u.jsx)("button",{className:"item Product",onMouseEnter:function(){return alert("*coming soon*")},children:"Make a new order"})]}):Object(u.jsx)(ae,{order:n,totalPrice:a,submitOrder:e.submitOrder,cancelOrder:e.cancelOrder,changeCount:e.changeCount,deleteProduct:e.deleteProduct,isEditMode:!!e.profile,profile:e.profile})}));var se=function(){return Object(u.jsxs)("div",{className:"App",children:[Object(u.jsx)(Z,{}),Object(u.jsxs)("div",{className:"Body container",children:[Object(u.jsx)(ie,{}),Object(u.jsx)(de,{})]})]})},le=function(e){return Object(u.jsx)(se,{})},fe=t(24),Oe=t(25),pe={};var be=[];var je={};var ve=[];var Ee=Object(o.b)({products:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case v:return Object(q.a)({},e);case E:return Object(q.a)(Object(q.a)({},e),{},{products:r.products});case R:return Object(q.a)(Object(q.a)({},e),{},{error:r.error});default:return e}},product:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:je,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case h:case _:return Object(q.a)({},e);case y:return Object(q.a)(Object(q.a)({},e),{},{error:r.error});case m:case C:return Object(q.a)({},e);case T:return Object(q.a)(Object(q.a)({},e),{},{error:r.error});case P:case g:return Object(q.a)({},e);case x:return Object(q.a)(Object(q.a)({},e),{},{error:r.error});default:return e}},order:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case N:return{order:null};case S:case U:case I:return Object(q.a)({},e);case D:return Object(q.a)(Object(q.a)({},e),{},{order:r.order});case k:return Object(q.a)(Object(q.a)({},e),{},{error:r.error});case w:case L:return Object(q.a)({},e);case G:return Object(q.a)(Object(q.a)({},e),{},{error:r.error});case M:case A:return Object(q.a)({},e);case B:return Object(q.a)(Object(q.a)({},e),{},{error:r.error});default:return e}},login:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pe,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case l:return Object(q.a)({},e);case f:return Object(q.a)(Object(q.a)({},e),{},{profile:r.profile});case O:return Object(q.a)(Object(q.a)({},e),{},{error:r.error});case p:return Object(q.a)({},e);case b:return{profile:null};case j:return{error:r.error};default:return e}}});var Re=function(e){var r=Object(Oe.createLogger)();return Object(o.d)(Ee,Object(o.a)(fe.a,r))}();window.store=Re,Object(n.render)(Object(u.jsx)(c.a,{store:Re,children:Object(u.jsx)(le,{})}),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.5a7efce3.chunk.js.map